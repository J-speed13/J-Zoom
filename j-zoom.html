<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J-zoom | Turbo Browser</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; overflow: hidden; background-color: #F1F5F9; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Custom Animations to match the React version */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse-custom { 50% { opacity: .5; } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .animate-fade-in { animation: fadeIn 0.7s ease-out forwards; }
        .animate-slide-up { animation: slideUp 1s ease-out forwards; }
        .animate-pulse-custom { animation: pulse-custom 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-zoom-in { animation: zoomIn 0.2s ease-out forwards; }

        /* Utility for hiding */
        .hidden-custom { display: none !important; }
    </style>
</head>
<body class="h-screen flex flex-col text-slate-900">

    <!-- 1. TABS BAR -->
    <div class="h-11 bg-slate-200/80 flex items-end px-2 gap-1 overflow-x-auto no-scrollbar pt-2 border-b border-slate-300/50" id="tabs-container">
        <!-- Tabs will be injected here by JS -->
    </div>

    <!-- 2. ADDRESS BAR -->
    <div class="h-16 bg-white border-b border-slate-200 flex items-center px-4 gap-4 shadow-sm z-30">
        <!-- Navigation Controls -->
        <div class="flex gap-1">
            <button onclick="console.log('Back')" class="p-2.5 rounded-2xl hover:bg-slate-100 text-slate-600 disabled:opacity-20 transition-all">
                <i data-lucide="arrow-left" class="w-5 h-5 stroke-[2.5]"></i>
            </button>
            <button onclick="console.log('Forward')" class="p-2.5 rounded-2xl hover:bg-slate-100 text-slate-600 disabled:opacity-20 transition-all">
                <i data-lucide="arrow-right" class="w-5 h-5 stroke-[2.5]"></i>
            </button>
            <button onclick="reloadTab()" class="p-2.5 rounded-2xl hover:bg-slate-100 text-slate-600 hover:rotate-180 transition-all duration-500">
                <i data-lucide="rotate-ccw" class="w-[18px] h-[18px] stroke-[2.5]"></i>
            </button>
        </div>

        <!-- Omnibox -->
        <div class="flex-1 relative flex items-center group">
            <!-- Security Icon -->
            <div class="absolute left-3.5 z-20 text-slate-400" id="security-icon">
                <i data-lucide="globe" class="w-3.5 h-3.5 stroke-[2.5]"></i>
            </div>

            <form id="url-form" class="w-full relative z-10">
                <input type="text" id="url-input" 
                    class="w-full h-11 pl-11 pr-28 rounded-2xl text-sm font-bold text-slate-700 bg-slate-100 focus:bg-white border-2 border-transparent focus:border-indigo-500 outline-none transition-all"
                    value="jzoom://home">
            </form>
            
            <!-- Shield Trigger -->
            <div class="absolute right-2 z-20 flex items-center">
                <button id="shield-btn" class="flex items-center gap-1.5 px-2.5 py-1.5 rounded-xl transition-all border border-transparent text-slate-400 hover:bg-slate-200">
                    <i data-lucide="shield-check" class="w-3.5 h-3.5 stroke-[2.5]"></i>
                    <span id="shield-count" class="text-[10px] font-black hidden">0</span>
                </button>
            </div>

            <!-- Shield Popup (Hidden by default) -->
            <div id="shield-popup" class="hidden-custom absolute top-14 right-0 w-72 bg-white rounded-3xl shadow-2xl border border-slate-100 p-5 z-50 animate-zoom-in origin-top-right">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-2">
                        <div class="p-2 bg-indigo-100 text-indigo-600 rounded-full">
                            <i data-lucide="shield-check" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-black text-sm text-slate-800">J-ZOOM SHIELD</h3>
                            <p class="text-[10px] text-slate-500 font-bold">PROTECTION ACTIVE</p>
                        </div>
                    </div>
                    <div class="w-10 h-6 bg-indigo-600 rounded-full flex items-center px-1">
                        <div class="w-4 h-4 bg-white rounded-full ml-auto shadow-sm"></div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-2xl border border-slate-100">
                        <span class="text-xs font-bold text-slate-600">Cross-site Trackers</span>
                        <span class="text-sm font-black text-indigo-600" id="popup-count">0</span>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                            <span>Safety Score</span><span>98%</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                            <div class="bg-emerald-500 h-full w-[98%]"></div>
                        </div>
                    </div>
                    <div class="pt-2 text-[10px] text-slate-400 text-center font-medium">
                        J-zoom blocked these items to speed up your browsing.
                    </div>
                </div>
            </div>
        </div>

        <button class="p-2.5 rounded-2xl text-slate-600 hover:bg-slate-100 transition-all">
            <i data-lucide="more-vertical" class="w-5 h-5 stroke-[2.5]"></i>
        </button>
    </div>

    <!-- 3. CONTENT AREA -->
    <div class="flex-1 bg-white relative overflow-hidden" id="content-area">
        <!-- Home Page View -->
        <div id="home-view" class="w-full h-full flex flex-col items-center justify-center p-4">
            <div class="w-full max-w-lg flex flex-col items-center space-y-8 -mt-24">
                <div class="flex items-center space-x-4 animate-fade-in">
                    <div class="w-20 h-20 bg-indigo-600 rounded-[2rem] flex items-center justify-center text-white shadow-2xl shadow-indigo-200">
                        <i data-lucide="zap" class="w-12 h-12 fill-white animate-pulse-custom"></i>
                    </div>
                    <h1 class="text-6xl font-black tracking-tighter text-slate-900">J-zoom</h1>
                </div>
                
                <form id="home-search-form" class="w-full relative group animate-slide-up">
                    <input type="text" id="home-search-input" placeholder="Search or type a URL..." 
                        class="w-full h-16 pl-14 pr-6 rounded-3xl border-2 border-slate-100 bg-slate-50 focus:bg-white shadow-sm focus:shadow-2xl focus:border-indigo-500 focus:ring-8 focus:ring-indigo-50 outline-none transition-all text-xl font-medium">
                    <div class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500">
                        <i data-lucide="search" class="w-6 h-6"></i>
                    </div>
                </form>

                <div class="flex gap-3 pt-4 animate-slide-up" style="animation-delay: 0.1s;">
                    <button class="px-5 py-2 text-sm font-bold text-slate-500 hover:text-indigo-600 bg-slate-100 hover:bg-indigo-50 rounded-xl transition-all">Top Sites</button>
                    <button class="px-5 py-2 text-sm font-bold text-slate-500 hover:text-indigo-600 bg-slate-100 hover:bg-indigo-50 rounded-xl transition-all">Images</button>
                    <button class="px-5 py-2 text-sm font-bold text-slate-500 hover:text-indigo-600 bg-slate-100 hover:bg-indigo-50 rounded-xl transition-all">News</button>
                </div>
            </div>
        </div>

        <!-- Web View (Iframe) -->
        <div id="web-view" class="hidden-custom w-full h-full flex flex-col">
            <div class="bg-indigo-900 text-white text-[10px] px-4 py-1.5 flex justify-between items-center shadow-md z-10">
                <span class="flex items-center gap-2 font-bold tracking-wider opacity-90">
                  <i data-lucide="shield" class="w-3 h-3 fill-white"></i> J-ZOOM ENHANCED PROTECTION
                </span>
                <span class="opacity-60 font-mono">TLS 1.3 / AES_256_GCM</span>
            </div>
            <iframe id="browser-frame" src="" class="flex-1 w-full border-none"></iframe>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="hidden-custom absolute inset-0 z-40 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm transition-all">
            <i data-lucide="zap" class="w-14 h-14 text-indigo-600 animate-bounce drop-shadow-lg fill-current"></i>
            <span class="text-[10px] font-black text-indigo-900 mt-6 tracking-[0.3em] animate-pulse-custom">SECURING CONNECTION...</span>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- State ---
        let tabs = [{ id: 1, title: 'J-zoom Home', url: 'jzoom://home', blockedCount: 0 }];
        let activeTabId = 1;
        
        // --- DOM Elements ---
        const tabsContainer = document.getElementById('tabs-container');
        const urlInput = document.getElementById('url-input');
        const homeSearchInput = document.getElementById('home-search-input');
        const homeView = document.getElementById('home-view');
        const webView = document.getElementById('web-view');
        const browserFrame = document.getElementById('browser-frame');
        const loadingOverlay = document.getElementById('loading-overlay');
        const shieldBtn = document.getElementById('shield-btn');
        const shieldPopup = document.getElementById('shield-popup');
        const shieldCountLabel = document.getElementById('shield-count');
        const popupCountLabel = document.getElementById('popup-count');
        const securityIcon = document.getElementById('security-icon');

        // --- Functions ---
        
        function renderTabs() {
            tabsContainer.innerHTML = '';
            tabs.forEach(tab => {
                const isActive = tab.id === activeTabId;
                const tabEl = document.createElement('div');
                tabEl.className = `group relative flex items-center h-8 min-w-[140px] max-w-[200px] px-4 rounded-t-xl text-[11px] font-bold cursor-default transition-all select-none ${isActive ? 'bg-white text-indigo-800 shadow-[0_-1px_4px_rgba(0,0,0,0.02)] z-10' : 'bg-transparent text-slate-500 hover:bg-slate-300/50'}`;
                
                // Content
                let badgeHtml = (tab.blockedCount > 0 && !isActive) 
                    ? `<span class="ml-2 px-1.5 py-0.5 bg-indigo-100 text-indigo-600 rounded text-[9px]">${tab.blockedCount}</span>` 
                    : '';
                
                tabEl.innerHTML = `
                    <div class="w-2 h-2 rounded-full mr-2 ${isActive ? 'bg-indigo-500' : 'bg-transparent'}"></div>
                    <span class="truncate flex-1 uppercase tracking-wider">${tab.title}</span>
                    ${badgeHtml}
                    <button onclick="closeTab(event, ${tab.id})" class="ml-1 p-0.5 rounded hover:bg-red-100 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                    ${!isActive ? '<div class="absolute right-0 top-2 bottom-2 w-px bg-slate-400/20 group-hover:hidden"></div>' : ''}
                `;
                
                tabEl.onclick = () => switchTab(tab.id);
                tabsContainer.appendChild(tabEl);
            });

            // Add Plus Button
            const addBtn = document.createElement('button');
            addBtn.className = "mb-1 ml-1 p-1.5 rounded-lg text-slate-500 hover:bg-white/60 hover:text-indigo-600 transition-colors";
            addBtn.innerHTML = '<i data-lucide="plus" class="w-4 h-4 stroke-[3]"></i>';
            addBtn.onclick = addTab;
            tabsContainer.appendChild(addBtn);

            lucide.createIcons();
        }

        function switchTab(id) {
            activeTabId = id;
            const tab = tabs.find(t => t.id === id);
            
            // Update UI State
            urlInput.value = tab.url;
            updateShieldUI(tab);
            renderTabs();
            
            // Handle View
            if (tab.url === 'jzoom://home') {
                homeView.classList.remove('hidden-custom');
                webView.classList.add('hidden-custom');
            } else {
                homeView.classList.add('hidden-custom');
                webView.classList.remove('hidden-custom');
                browserFrame.src = tab.url;
                
                // Update Security Icon
                if (tab.url.startsWith('https')) {
                    securityIcon.innerHTML = '<i data-lucide="lock" class="w-3.5 h-3.5 stroke-[2.5] text-emerald-500"></i>';
                } else {
                    securityIcon.innerHTML = '<i data-lucide="globe" class="w-3.5 h-3.5 stroke-[2.5]"></i>';
                }
                lucide.createIcons();
            }
        }

        function navigate(query) {
            let url = query;
            let title = "Loading...";
            
            // URL Normalization
            if (!url.startsWith('http') && !url.startsWith('jzoom://')) {
                if (url.includes('.') && !url.includes(' ')) {
                    url = `https://${url}`;
                    title = url;
                } else {
                    url = `https://www.bing.com/search?q=${encodeURIComponent(url)}`;
                    title = `${query} - Search`;
                }
            } else if (url.startsWith('jzoom://')) {
                title = "J-zoom Home";
            } else {
                try { title = new URL(url).hostname; } catch(e) { title = url; }
            }

            // Update Tab Data
            const tabIndex = tabs.findIndex(t => t.id === activeTabId);
            tabs[tabIndex].url = url;
            tabs[tabIndex].title = title;
            tabs[tabIndex].blockedCount = url.includes('jzoom') ? 0 : Math.floor(Math.random() * 20) + 3;

            // Trigger Loading
            loadingOverlay.classList.remove('hidden-custom');
            
            setTimeout(() => {
                loadingOverlay.classList.add('hidden-custom');
                switchTab(activeTabId); // Re-render view
            }, 800);
        }

        function addTab() {
            const newId = Date.now();
            tabs.push({ id: newId, title: 'J-zoom Home', url: 'jzoom://home', blockedCount: 0 });
            switchTab(newId);
        }

        function closeTab(e, id) {
            e.stopPropagation();
            if (tabs.length === 1) return;
            
            tabs = tabs.filter(t => t.id !== id);
            if (activeTabId === id) {
                activeTabId = tabs[tabs.length - 1].id;
            }
            switchTab(activeTabId);
        }

        function reloadTab() {
            const tab = tabs.find(t => t.id === activeTabId);
            navigate(tab.url);
        }

        function updateShieldUI(tab) {
            shieldPopup.classList.add('hidden-custom'); // Close popup on nav
            
            // FIX: Safely find the icon, whether it's the original <i> or the rendered <svg>
            const icon = shieldBtn.querySelector('i') || shieldBtn.querySelector('svg');

            if (tab.blockedCount > 0) {
                shieldBtn.className = "flex items-center gap-1.5 px-2.5 py-1.5 rounded-xl transition-all border border-transparent bg-indigo-600 text-white shadow-md hover:bg-indigo-700 hover:scale-105";
                shieldCountLabel.textContent = tab.blockedCount;
                shieldCountLabel.classList.remove('hidden');
                popupCountLabel.textContent = tab.blockedCount;
                // Add fill
                if (icon) icon.setAttribute('fill', 'currentColor');
            } else {
                shieldBtn.className = "flex items-center gap-1.5 px-2.5 py-1.5 rounded-xl transition-all border border-transparent text-slate-400 hover:bg-slate-200";
                shieldCountLabel.classList.add('hidden');
                if (icon) icon.setAttribute('fill', 'none');
            }
            lucide.createIcons();
        }

        // --- Event Listeners ---
        document.getElementById('url-form').onsubmit = (e) => {
            e.preventDefault();
            navigate(urlInput.value);
        };

        document.getElementById('home-search-form').onsubmit = (e) => {
            e.preventDefault();
            navigate(homeSearchInput.value);
        };

        shieldBtn.onclick = () => {
            shieldPopup.classList.toggle('hidden-custom');
        };

        // Init
        renderTabs();
        lucide.createIcons();

    </script>
</body>
</html>